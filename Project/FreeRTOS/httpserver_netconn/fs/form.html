<!DOCTYPE html>
<html>
<body>

    
    <form action="javascript:void(0);" onsubmit="myFunction(this)">
        IP address:
        <input type="text" id="ip1" value="192" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="ip2" value="168" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="ip3" value="150" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="ip4" value="21" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        Mask:
        <input type="text" id="mask1" value="255" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="mask2" value="255" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="mask3" value="255" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="mask4" value="0" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        GW:
        <input type="text" id="gw1" value="192" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="gw2" value="168" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="gw3" value="150" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required />.
        <input type="text" id="gw4" value="1" style="width:25px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        UVTK KP address:
        <input type="text" id="uvtk_kp_addr" value="1" style="width:30px;"
               pattern="(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        Number of TS in group:
        <select id="ts_grp_size">
            <option value="4">32</option>
            <option value="8">64</option>
        </select><br>
        Number of TS groups:
        <select id="ts_grp_num">
            <option value="0">no TS</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select><br>
        Number of TI in group:
        <select id="ti_grp_size" disabled>
            <option value="16">16</option>
        </select><br>
        Number of TI groups:
        <select id="ti_grp_num">
            <option value="0">no TI</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select><br>
        Poll delay:
        <input type="text" id="poll_delay" value="20" style="width:30px;"
               pattern="([0-9]+)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /> s.<br>
        <fieldset style="width:230px">
            <legend>Inversion</legend>
            <input type="checkbox" id="inp_inv" value="input" />Input<br>
            <input type="checkbox" id="out_inv" value="output" />Output<br>
        </fieldset><br>
        IEC ASDU address:
        <input type="text" id="iec_asdu_addr" value="21" style="width:50px;" max=30
               pattern="([0-9]+)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        IEC Socket Port:
        <input type="text" id="iec_sock_port" value="2404" style="width:50px;"
               pattern="([0-9]+)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        TS IEC offset:
        <input type="text" id="iec_sp_ioa_offset" value="101" style="width:50px;"
               pattern="([0-9]+)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        TI IEC offset:
        <input type="text" id="iec_mv_ioa_offset" value="1001" style="width:50px;"
               pattern="([0-9]+)" oninvalid="InvalidMsg(this);" oninput="InvalidMsg(this);" required /><br>
        <p><input type="submit" value="Submit" /></p>
    </form>

    <p id="demo"></p>
    <script>
        function myFunction(form) {
            var xhr = new XMLHttpRequest();
            var params = "";
            for (i = 0; i < form.length; i++) {
                elem = form[i];
                if(elem.id != ""){
                    params += elem.id + "=" + elem.value + "\n";
                }
                
                
            }
            console.info(params);
            
            xhr.open("POST", 'http://192.168.150.21');
            xhr.send(params);
            xhr.onreadystatechange = function () {
                document.getElementById("ip1").value = '123';
                if (xhr.readyState == xhr.DONE) {
                    document.getElementById("ip1").value = '192';
                }
            }
        }

        function InvalidMsg(textbox) {
            id = textbox.id;
            if (textbox.validity.patternMismatch) {
                if (id.indexOf("ip") == 0 | id.indexOf("mask") == 0 | id.indexOf("gw") == 0) {
                    textbox.setCustomValidity('Invalid IP address\nEnter number in range [0-255]');
                }
                else if (id.indexOf("uvtk_kp_addr") == 0) {
                    textbox.setCustomValidity('Invalid KP address\nEnter number in range[0-255]');
                }
                else if (id.indexOf("poll_delay") == 0) {
                    textbox.setCustomValidity('Invalid delay value\nEnter numerical value in seconds');
                }
                else if (id.indexOf("iec_asdu_addr") == 0) {
                    textbox.setCustomValidity('Invalid ASDU address\nEnter numerical value');
                }
                else if (id.indexOf("iec_sock_port") == 0) {
                    textbox.setCustomValidity('Invalid Port address\nEnter numerical value');
                }
                else if (id.indexOf("iec_sp_ioa_offset") == 0 | id.indexOf("iec_mv_ioa_offset") == 0) {
                    textbox.setCustomValidity('Invalid offset address\nEnter numerical value');
                }
                else {
                    textbox.setCustomValidity('Custom error');
                }
            }
            else {
                if ((id.indexOf("iec_asdu_addr") == 0 | id.indexOf("iec_sock_port") == 0 | id.indexOf("iec_sp_ioa_offset") == 0
                    | id.indexOf("iec_mv_ioa_offset") == 0 | id.indexOf("iec_asdu_addr") == 0) && textbox.value > 65535) {
                    textbox.setCustomValidity('Error: value is too high');
                }
                else {
                    textbox.setCustomValidity('');
                }
            }
 
            return true;
        }
    </script>
</body>
</html>
